# Physics-Informed Diffusion for CFD - Default Configuration
#
# Quick start:
#   python test_cpu.py              # Creates synthetic data + verifies setup
#   python main.py --mode train     # Train model
#   python main.py --mode sample --checkpoint checkpoints/final_model.pth
#
# For full 256x256 training, update:
#   data.data_dir: "/path/to/kf_2d_re1000_256_40seed.npy"
#   data.image_size: 256
#   model.base_channels: 64
#   model.channel_mult: [1, 1, 1, 2]

# =============================================================================
# DATA
# =============================================================================
data:
  dataset: "kolmogorov_flow"
  # For testing: use synthetic data (created by test_cpu.py)
  data_dir: "./data/test/synthetic_test.npy"
  # For real training: use actual Kolmogorov flow data
  # data_dir: "/path/to/kf_2d_re1000_256_40seed.npy"
  image_size: 64        # 64 for testing, 256 for full
  channels: 3           # 3 consecutive timesteps as input
  train_split: 0.9
  max_samples: null     # null = use all, or set integer to limit

# =============================================================================
# MODEL
# =============================================================================
model:
  type: "conditional"   # "simple" (unconditional) or "conditional" (physics-guided)
  in_channels: 3
  out_channels: 3
  base_channels: 32     # 32 for testing, 64 for full training
  channel_mult: [1, 2, 4]  # Channel multipliers at each resolution level
  # For 256x256: channel_mult: [1, 1, 1, 2]
  num_res_blocks: 2
  attention_resolutions: [16]  # Apply attention at these spatial resolutions
  dropout: 0.1
  num_groups: 8         # For GroupNorm (must divide base_channels)

# =============================================================================
# DIFFUSION
# =============================================================================
diffusion:
  num_timesteps: 1000
  beta_schedule: "linear"  # "linear", "cosine", or "quadratic"
  beta_start: 0.0001
  beta_end: 0.02

# =============================================================================
# TRAINING
# =============================================================================
training:
  batch_size: 2
  num_epochs: 10        # 10 for testing, 100+ for full training
  learning_rate: 0.0002
  weight_decay: 0.0
  grad_clip: 1.0
  ema_rate: 0.9999
  use_ema: true
  save_freq: 5000       # Save checkpoint every N steps
  log_freq: 100         # Log to tensorboard every N steps

# =============================================================================
# SAMPLING / INFERENCE
# =============================================================================
sampling:
  batch_size: 4
  num_steps: 50         # Number of DDIM/DDPM steps
  eta: 0.0              # 0.0 = DDIM (deterministic), 1.0 = DDPM (stochastic)
  guidance_scale: 0.0   # Classifier-free guidance weight
  physics_weight: 0.0   # Physics residual guidance weight (try 0.01-0.1)

# =============================================================================
# PHYSICS (Kolmogorov Flow)
# =============================================================================
physics:
  reynolds_number: 1000
  dt: 0.03125           # 1/32 temporal discretization
  domain_size: 6.283185307179586  # 2*pi

# =============================================================================
# PATHS
# =============================================================================
paths:
  checkpoint_dir: "./checkpoints"
  log_dir: "./logs"
  output_dir: "./outputs"
